
pipeline {
    agent any
    
    environment {
        GEMINI_KEY = credentials('GEMINI_API_KEY')
    }
    
    stages {
        stage('Checkout Code') {
            steps {
                git branch: 'main', 
                    url: 'https://github.com/Ayzazkhan/Godady-digilaxy-partner-page-automation.git',
                    credentialsId: 'github-credentials'
            }
        }
        
       stage('Verify Files') {
            steps {
                sh '''
                echo "ğŸ“ Current workspace after checkout:"
                pwd
                ls -la
                echo "ğŸ” Checking specific files:"
                ls -la content_generator.py
                ls -la content.json
                ls -la Jenkinsfile
                '''
            }
        }
        
        stage('Setup Python Environment') {
            steps {
                sh '''
                python3 -m venv venv
                . venv/bin/activate
                pip install --upgrade pip
                pip install google-generativeai requests
                '''
            }
        }
        
        stage('Generate Content') {
            steps {
                sh '''
                . venv/bin/activate
                python3 content_generator.py
                '''
            }
        }
        
        stage('Check Results') {
            steps {
                sh '''
                echo "ğŸ“Š Generation completed! Checking output:"
                ls -la generated_content.json
                echo "ğŸ“ˆ First few lines of generated content:"
                head -5 generated_content.json
                '''
                archiveArtifacts artifacts: 'generated_content.json', fingerprint: true
            }
        }
    }
    
    post {
        always {
            sh 'rm -rf venv'  // Cleanup virtual environment
        }
        success {
            echo 'âœ… Content generation completed successfully!'
            emailext (
                subject: 'SUCCESS: Content Generation Completed',
                body: '175 content pieces generated successfully!',
                to: 'YOUR_EMAIL@example.com'
            )
        }
        failure {
            echo 'âŒ Content generation failed!'
        }
    }
}
