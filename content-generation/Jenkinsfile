
pipeline {
    agent any
    
    environment {
        GEMINI_KEY = credentials('GEMINI_API_KEY')
    }
    
    stages {
        stage('Checkout Code') {
            steps {
                git branch: 'main', 
                    url: 'https://github.com/Ayzazkhan/Godady-digilaxy-partner-page-automation.git',
                    credentialsId: 'github-credentials'
            }
        }
     stage('Verify Files') {
            steps {
                sh '''
                echo "ğŸ“ Current workspace after checkout:"
                pwd
                ls -la
                echo "ğŸ“ Checking content-generation folder:"
                ls -la content-generation/
                echo "ğŸ” Checking specific files:"
                ls -la content-generation/content_generator.py
                ls -la content-generation/content.json
                ls -la content-generation/Jenkinsfile
                '''
            }
        }
        
        stage('Setup Python Environment') {
            steps {
                dir('content-generation') {
                    sh '''
                    python3 -m venv venv
                    . venv/bin/activate
                    pip install --upgrade pip
                    pip install google-generativeai requests
                    '''
                }
            }
        }
        
        stage('Generate Content') {
            steps {
                dir('content-generation') {
                    sh '''
                    . venv/bin/activate
                    python3 content_generator.py
                    '''
                }
            }
        }
        
        stage('Check Results') {
            steps {
                dir('content-generation') {
                    sh '''
                    echo "ğŸ“Š Generation completed! Checking output:"
                    ls -la generated_content.json
                    echo "ğŸ“ˆ Number of content pieces generated:"
                    python3 -c "import json; data = json.load(open('generated_content.json')); print(f'Total: {len(data)}')"
                    '''
                    archiveArtifacts artifacts: 'generated_content.json', fingerprint: true
                }
            }
        }
    }
    
    post {
        always {
            sh 'rm -rf content-generation/venv'  // Cleanup
        }
        success {
            echo 'âœ… Content generation completed successfully!'
        }
        failure {
            echo 'âŒ Content generation failed!'
        }
    }
}
